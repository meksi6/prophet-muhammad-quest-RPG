        .help-counter {
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
        }

        .help-hint {
            background: rgba(255, 255, 255, 0.9);
            color: #8b4513;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-weight: bold;
            border: 2px solid #d4a574;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .character-display {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .chapters-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .epic-title {
                font-size: 2.5em;
            }
            
            .battle-participants {
                flex-direction: column;
                gap: 30px;
            }
            
            .vs-indicator {
                order: 2;
                margin: 20px 0;
            }
            
            .answer-grid {
                grid-template-columns: 1fr;
            }
            
            .action-panel {
                flex-direction: column;
                align-items: center;
            }
            
            .music-control {
                position: relative;
                margin-bottom: 20px;
            }
            
            .turkish-help-panel {
                position: relative;
                right: auto;
                transform: none;
                margin: 20px 0;
            }
        }

        /* Special Effects */
        .text-glow {
            text-shadow: 0 0 10px rgba(243, 156, 18, 0.8);
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .bounce {
            animation: bounce 1s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .fade-in {
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        /* Achievement Popup */
        .achievement-popup {
            position: fixed;
            top: 100px;
            right: 20px;
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #d35400;
            z-index: 3000;
            transform: translateX(400px);
            transition: transform 0.5s ease;
            max-width: 300px;
            box-shadow: 0 10px 30px rgba(243, 156, 18, 0.4);
        }

        .achievement-popup.show {
            transform: translateX(0);
        }

        .achievement-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .achievement-description {
            font-size: 0.9em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- Background Particles -->
    <div class="particles" id="particles"></div>

    <!-- Music Control Panel -->
    <div class="music-control">
        <button class="music-toggle" id="musicToggle" onclick="toggleMusic()">🎵 Music: OFF</button>
        <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50" onchange="changeVolume()">
        <div style="text-align: center; margin-top: 5px; font-size: 0.8em; color: #bdc3c7;">Volume</div>
    </div>

    <!-- Turkish Help Panel -->
    <div class="turkish-help-panel" id="turkishHelpPanel" style="display: none;">
        <div class="help-counter">🆘 Turkish Help: <span id="helpCount">5</span></div>
        <div style="text-align: center; font-weight: bold;">Click to get hints in Turkish!</div>
        <div class="help-hint" id="helpHint" style="display: none;">
            <!-- Dynamic hint content -->
        </div>
    </div>

    <!-- Achievement Popup -->
    <div class="achievement-popup" id="achievementPopup">
        <div class="achievement-title" id="achievementTitle">🏆 Achievement Unlocked!</div>
        <div class="achievement-description" id="achievementDescription">You've earned a new achievement!</div>
    </div>

    <div class="container">
        <!-- Epic Header -->
        <div class="epic-header">
            <h1 class="epic-title">🎵 PROPHET MUHAMMAD EPIC QUEST 🎵</h1>
            <p class="epic-subtitle">⚔️ The Complete Journey - 4 Weeks of Adventure ⚔️</p>
            <div style="background: rgba(241, 196, 15, 0.2); border: 2px solid #f1c40f; border-radius: 15px; padding: 20px; margin-top: 20px;">
                <strong>🇹🇷 Epic RPG Macerası:</strong> 4 haftalık tam hikaye! Karakterini geliştir, beceriler öğren, boss'ları yen! 
                Müzik + animasyon + büyük macera! Hazır mısın kahraman? 🎮
            </div>
        </div>

        <!-- Enhanced Character Display -->
        <div class="character-display">
            <div class="character-avatar-section">
                <div class="character-avatar" id="playerAvatar" onclick="showCharacterDetails()">🛡️</div>
                <div class="character-name" id="playerName">English Scholar Knight</div>
                <div class="character-class" id="playerClass">Level <span id="playerLevel">1</span> Seeker of Truth</div>
                <div style="margin-top: 15px; font-size: 0.9em; color: #bdc3c7;">
                    🏆 Achievements: <span id="achievementCount">0</span>/20
                </div>
            </div>
            
            <div class="character-stats">
                <div class="stat-row">
                    <span class="stat-label">❤️ Health</span>
                    <div class="stat-bar-container">
                        <div class="stat-bar health-bar" id="healthBar" style="width: 100%;"></div>
                    </div>
                    <span class="stat-value" id="healthText">100/100</span>
                </div>
                
                <div class="stat-row">
                    <span class="stat-label">⭐ Experience</span>
                    <div class="stat-bar-container">
                        <div class="stat-bar exp-bar" id="expBar" style="width: 0%;"></div>
                    </div>
                    <span class="stat-value" id="expText">0/200</span>
                </div>
                
                <div class="stat-row">
                    <span class="stat-label">🧠 Wisdom</span>
                    <div class="stat-bar-container">
                        <div class="stat-bar wisdom-bar" id="wisdomBar" style="width: 0%;"></div>
                    </div>
                    <span class="stat-value" id="wisdomText">0/100</span>
                </div>
                
                <div class="stat-row">
                    <span class="stat-label">💪 Courage</span>
                    <div class="stat-bar-container">
                        <div class="stat-bar courage-bar" id="courageBar" style="width: 0%;"></div>
                    </div>
                    <span class="stat-value" id="courageText">0/100</span>
                </div>
                
                <div class="stat-row">
                    <span class="stat-label">❤️ Compassion</span>
                    <div class="stat-bar-container">
                        <div class="stat-bar compassion-bar" id="compassionBar" style="width: 0%;"></div>
                    </div>
                    <span class="stat-value" id="compassionText">0/100</span>
                </div>
                
                <div class="stat-row">
                    <span class="stat-label">👑 Leadership</span>
                    <div class="stat-bar-container">
                        <div class="stat-bar leadership-bar" id="leadershipBar" style="width: 0%;"></div>
                    </div>
                    <span class="stat-value" id="leadershipText">0/100</span>
                </div>
            </div>
            
            <div class="inventory-panel">
                <div class="inventory-title">📦 Sacred Inventory</div>
                <div class="inventory-grid" id="inventoryGrid">
                    <!-- 12 slots for more items -->
                    <div class="inventory-slot" data-slot="0">📭<div class="item-tooltip">Empty Slot</div></div>
                    <div class="inventory-slot" data-slot="1">📭<div class="item-tooltip">Empty Slot</div></div>
                    <div class="inventory-slot" data-slot="2">📭<div class="item-tooltip">Empty Slot</div></div>
                    <div class="inventory-slot" data-slot="3">📭<div class="item-tooltip">Empty Slot</div></div>
                    <div class="inventory-slot" data-slot="4">📭<div class="item-tooltip">Empty Slot</div></div>
                    <div class="inventory-slot" data-slot="5">📭<div class="item-tooltip">Empty Slot</div></div>
                    <div class="inventory-slot" data-slot="6">📭<div class="item-tooltip">Empty Slot</div></div>
                    <div class="inventory-slot" data-slot="7">📭<div class="item-tooltip">Empty Slot</div></div>
                    <div class="inventory-slot" data-slot="8">📭<div class="item-tooltip">Empty Slot</div></div>
                    <div class="inventory-slot" data-slot="9">📭<div class="item-tooltip">Empty Slot</div></div>
                    <div class="inventory-slot" data-slot="10">📭<div class="item-tooltip">Empty Slot</div></div>
                    <div class="inventory-slot" data-slot="11">📭<div class="item-tooltip">Empty Slot</div></div>
                </div>
            </div>
        </div>

        <!-- Chapter Selection Map -->
        <div class="chapter-map">
            <h2 class="map-title">🗺️ THE PROPHET'S EPIC JOURNEY</h2>
            <p style="text-align: center; color: #bdc3c7; font-size: 1.1em; margin-bottom: 30px;">
                Follow the complete life story of Prophet Muhammad (PBUH) through 4 epic chapters
            </p>
            
            <div class="chapters-grid">
                <!-- Week 1: The Orphan's Rise -->
                <div class="chapter-card current" onclick="startChapter('week1')" id="chapter-week1">
                    <span class="chapter-icon">👶</span>
                    <div class="chapter-title">Week 1: The Orphan's Rise</div>
                    <div class="chapter-description">
                        From birth to marriage - discover Muhammad's character development, his trustworthy nature, and early life challenges.
                    </div>
                    <div class="chapter-progress">Progress: <span id="week1-progress">0</span>/15 Quests</div>
                    <div class="chapter-rewards">🎁 Trustworthy Badge, Orphan's Wisdom, Merchant Skills</div>
                </div>
                
                <!-- Week 2: The Call to Truth -->
                <div class="chapter-card locked" id="chapter-week2">
                    <span class="chapter-icon">👼</span>
                    <div class="chapter-title">Week 2: The Call to Truth</div>
                    <div class="chapter-description">
                        The first revelation, early Muslim community, persecution, and the journey to Abyssinia for religious freedom.
                    </div>
                    <div class="chapter-progress">Progress: 0/18 Quests</div>
                    <div class="chapter-rewards">🎁 Prophet's Light, Angel's Blessing, Community Builder</div>
                </div>
                
                <!-- Week 3: The Great Journey -->
                <div class="chapter-card locked" id="chapter-week3">
                    <span class="chapter-icon">🌙</span>
                    <div class="chapter-title">Week 3: The Great Journey</div>
                    <div class="chapter-description">
                        Night Journey, Hijrah to Medina, building the first Islamic state, and major battles for survival.
                    </div>
                    <div class="chapter-progress">Progress: 0/20 Quests</div>
                    <div class="chapter-rewards">🎁 Traveler's Compass, Leader's Crown, Warrior's Courage</div>
                </div>
                
                <!-- Week 4: The Final Victory -->
                <div class="chapter-card locked" id="chapter-week4">
                    <span class="chapter-icon">🏆</span>
                    <div class="chapter-title">Week 4: The Final Victory</div>
                    <div class="chapter-description">
                        Return to Mecca, spreading Islam, the Farewell Pilgrimage, and the Prophet's lasting legacy.
                    </div>
                    <div class="chapter-progress">Progress: 0/22 Quests</div>
                    <div class="chapter-rewards">🎁 Conqueror's Medal, Peace Maker, Eternal Legacy</div>
                </div>
            </div>
        </div>

        <!-- Battle Arena -->
        <div class="battle-arena" id="battleArena">
            <div class="battle-header">
                <h2 class="battle-title" id="battleTitle">⚔️ EPIC BATTLE ⚔️</h2>
                <p class="battle-subtitle" id="battleSubtitle">Test your knowledge and courage!</p>
            </div>
            
            <div class="battle-participants">
                <div class="participant">
                    <div class="participant-avatar player-avatar" id="battlePlayerAvatar">🛡️</div>
                    <div class="participant-name" id="battlePlayerName">English Scholar Knight</div>
                    <div class="participant-health player-health">
                        <div class="health-fill" id="battlePlayerHealth" style="width: 100%;"></div>
                        <div class="health-text" id="battlePlayerHealthText">100/100</div>
                    </div>
                </div>
                
                <div class="vs-indicator">⚔️ VS ⚔️</div>
                
                <div class="participant">
                    <div class="participant-avatar enemy-avatar" id="battleEnemyAvatar">👹</div>
                    <div class="participant-name" id="battleEnemyName">Knowledge Guardian</div>
                    <div class="participant-health enemy-health">
                        <div class="health-fill" id="battleEnemyHealth" style="width: 100%;"></div>
                        <div class="health-text" id="battleEnemyHealthText">100/100</div>
                    </div>
                </div>
            </div>
            
            <div class="question-panel" id="questionPanel">
                <div class="question-header">
                    <div class="question-number" id="questionNumber">Question 1 of 5</div>
                    <div class="question-difficulty" id="questionDifficulty">★★☆ Medium</div>
                </div>
                
                <div class="question-text" id="questionText">
                    Prepare yourself, brave knight! The Knowledge Guardian challenges your understanding!
                </div>
                
                <div class="answer-grid" id="answerGrid">
                    <!-- Dynamic answer choices -->
                </div>
            </div>
            
            <div class="combat-log-panel" id="combatLog">
                <div class="log-entry log-system">⚔️ Battle commences! May your knowledge guide your blade!</div>
                <div class="log-entry log-system">💡 Answer correctly to strike your enemy!</div>
                <div class="log-entry log-system">❌ Wrong answers will cost you health!</div>
            </div>
            
            <div class="action-panel">
                <button class="action-btn help-btn" onclick="useTurkishHelp()" id="helpButton">
                    🆘 Turkish Help (5 left)
                </button>
                <button class="action-btn" onclick="useSpecialAttack()" id="specialAttackBtn" disabled>
                    ⚡ Special Attack
                </button>
                <button class="action-btn retreat-btn" onclick="retreatFromBattle()">
                    🏃 Strategic Retreat
                </button>
            </div>
        </div>
    </div>

    <!-- Victory Modal -->
    <div class="modal-overlay" id="victoryModal">
        <div class="modal-content victory-content">
            <h2 class="modal-title">🏆 VICTORY!</h2>
            <div class="modal-message" id="victoryMessage">
                Congratulations, brave knight! You have proven your wisdom and courage!
            </div>
            <div class="reward-display" id="victoryRewards">
                <!-- Dynamic reward content -->
            </div>
            <button class="action-btn" onclick="closeModal('victory')">Continue Quest</button>
        </div>
    </div>

    <!-- Defeat Modal -->
    <div class="modal-overlay" id="defeatModal">
        <div class="modal-content defeat-content">
            <h2 class="modal-title">💀 DEFEAT</h2>
            <div class="modal-message" id="defeatMessage">
                Fear not, brave knight! Every defeat is a lesson. Rise and try again!
            </div>
            <div class="reward-display" id="defeatRewards">
                <div class="reward-item">
                    <span>📚 Lesson Learned</span>
                    <span>+5 Wisdom</span>
                </div>
                <div class="reward-item">
                    <span>💪 Determination</span>
                    <span>+3 Courage</span>
                </div>
            </div>
            <button class="action-btn" onclick="closeModal('defeat')">Try Again</button>
            <button class="action-btn retreat-btn" onclick="returnToMap()">Return to Map</button>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="backgroundMusic" loop>
        <source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.wav" type="audio/wav">
        <!-- Fallback: We'll use Web Audio API to generate tones -->
    </audio>

    <script>
        // Game State
        let gameState = {
            player: {
                name: "English Scholar Knight",
                level: 1,
                health: 100,
                maxHealth: 100,
                exp: 0,
                expToNext: 200,
                wisdom: 0,
                courage: 0,
                compassion: 0,
                leadership: 0,
                inventory: [],
                achievements: [],
                currentChapter: 'week1',
                chaptersCompleted: [],
                specialAttackReady: false
            },
            game: {
                turkishHelpCount: 5,
                musicEnabled: false,
                audioContext: null,
                currentBattle: null,
                achievements: [
                    { id: 'first_victory', name: 'First Victory', description: 'Win your first battle!' },
                    { id: 'scholar', name: 'Scholar', description: 'Answer 25 questions correctly' },
                    { id: 'brave_heart', name: 'Brave Heart', description: 'Complete a battle without using Turkish help' },
                    { id: 'week1_complete', name: 'The Orphan\'s Journey', description: 'Complete Week 1' },
                    { id: 'perfectionist', name: 'Perfectionist', description: 'Get 5 answers correct in a row' },
                    // ... more achievements
                ]
            }
        };

        // Audio System
        function initAudio() {
            try {
                gameState.game.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.log('Web Audio API not supported');
            }
        }

        function playTone(frequency, duration, type = 'sine') {
            if (!gameState.game.audioContext || !gameState.game.musicEnabled) return;
            
            const oscillator = gameState.game.audioContext.createOscillator();
            const gainNode = gameState.game.audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(gameState.game.audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, gameState.game.audioContext.currentTime);
            oscillator.type = type;
            
            gainNode.gain.setValueAtTime(0.1, gameState.game.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, gameState.game.audioContext.currentTime + duration);
            
            oscillator.start(gameState.game.audioContext.currentTime);
            oscillator.stop(gameState.game.audioContext.currentTime + duration);
        }

        function playVictorySound() {
            if (!gameState.game.musicEnabled) return;
            // Play victory melody
            const notes = [523.25, 659.25, 783.99, 1046.50]; // C, E, G, C
            notes.forEach((note, index) => {
                setTimeout(() => playTone(note, 0.3), index * 200);
            });
        }

        function playDefeatSound() {
            if (!gameState.game.musicEnabled) return;
            // Play sad melody
            const notes = [400, 350, 300, 250]; // Descending tones
            notes.forEach((note, index) => {
                setTimeout(() => playTone(note, 0.5, 'sawtooth'), index * 300);
            });
        }

        function playCorrectAnswerSound() {
            if (!gameState.game.musicEnabled) return;
            playTone(800, 0.2);
        }

        function playIncorrectAnswerSound() {
            if (!gameState.game.musicEnabled) return;
            playTone(200, 0.5, 'sawtooth');
        }

        function toggleMusic() {
            gameState.game.musicEnabled = !gameState.game.musicEnabled;
            const button = document.getElementById('musicToggle');
            
            if (gameState.game.musicEnabled) {
                button.textContent = '🎵 Music: ON';
                button.classList.add('playing');
                initAudio();
                playTone(440, 0.3); // Test sound
            } else {
                button.textContent = '🎵 Music: OFF';
                button.classList.remove('playing');
            }
        }

        function changeVolume() {
            const volume = document.getElementById('volumeSlider').value / 100;
            // This would adjust the gain if we had persistent audio
            console.log('Volume set to:', volume);
        }

        // Particle System
        function createParticles() {
            const container = document.getElementById('particles');
            
            function addParticle() {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.width = particle.style.height = (Math.random() * 4 + 2) + 'px';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
                particle.style.animationDelay = Math.random() * 2 + 's';
                
                container.appendChild(particle);
                
                // Remove particle after animation
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 8000);
            }
            
            // Add particles periodically
            setInterval(addParticle, 500);
        }

        // Week 1 Quest Data
        const questData = {
            week1: {
                title: "The Orphan's Rise",
                description: "Follow Muhammad's journey from orphan to Al-Amin",
                sections: [
                    {
                        name: "Childhood Trials",
                        boss: "Guardian of Memories",
                        avatar: "👶",
                        health: 120,
                        questions: [
                            {
                                text: "What does 'ORPHAN' mean?",
                                answers: ["A rich person", "A child whose parents died", "A merchant", "A teacher"],
                                correct: 1,
                                difficulty: "★☆☆",
                                damage: 30,
                                rewards: { exp: 25, wisdom: 8, item: "Orphan's Wisdom Gem" },
                                turkishHint: "🇹🇷 Anne babası ölmüş çocuk demek"
                            },
                            {
                                text: "Who took care of baby Muhammad in the desert?",
                                answers: ["His mother", "Halimah", "His grandfather", "Abu Talib"],
                                correct: 1,
                                difficulty: "★☆☆",
                                damage: 30,
                                rewards: { exp: 25, wisdom: 8, item: "Desert Blessing" },
                                turkishHint: "🇹🇷 Halime ana çölde büyüttü"
                            },
                            {
                                text: "What amazing things happened when Halimah cared for Muhammad?",
                                answers: ["Nothing special", "Her animals gave more milk and land became green", "She became rich", "She moved to the city"],
                                correct: 1,
                                difficulty: "★★☆",
                                damage: 30,
                                rewards: { exp: 30, wisdom: 10, compassion: 5, item: "Blessing of Abundance" },
                                turkishHint: "🇹🇷 Hayvanları daha çok süt verdi, toprakları yeşillendi"
                            },
                            {
                                text: "At what age did Muhammad become an orphan (lost both parents)?",
                                answers: ["2 years old", "4 years old", "6 years old", "8 years old"],
                                correct: 2,
                                difficulty: "★★☆",
                                damage: 30,
                                rewards: { exp: 30, courage: 10, item: "Courage in Hardship" },
                                turkishHint: "🇹🇷 6 yaşında annesi öldü, babası zaten ölmüştü"
                            },
                            {
                                text: "Who became Muhammad's guardian after his mother died?",
                                answers: ["Abu Talib", "Abd al-Muttalib (grandfather)", "Abu Bakr", "Khadijah"],
                                correct: 1,
                                difficulty: "★★☆",
                                damage: 30,
                                rewards: { exp: 25, wisdom: 8, item: "Guardian's Protection" },
                                turkishHint: "🇹🇷 İlk dedesi Abd al-Muttalib sahip çıktı"
                            }
                        ]
                    },
                    {
                        name: "Youth Character Building",
                        boss: "Guardian of Truth",
                        avatar: "👨",
                        health: 150,
                        questions: [
                            {
                                text: "Why was Muhammad called 'Al-Amin'?",
                                answers: ["He was rich", "He was trustworthy and honest", "He was strong", "He was young"],
                                correct: 1,
                                difficulty: "★★☆",
                                damage: 40,
                                rewards: { exp: 35, wisdom: 12, leadership: 8, item: "Trustworthy Badge" },
                                turkishHint: "🇹🇷 Güvenilir ve dürüst olduğu için El-Emin dediler"
                            },
                            {
                                text: "What does 'TRUSTWORTHY' mean?",
                                answers: ["Someone you can depend on", "Someone who is rich", "Someone who is strong", "Someone who is young"],
                                correct: 0,
                                difficulty: "★☆☆",
                                damage: 40,
                                rewards: { exp: 30, wisdom: 10, item: "Truth Crystal" },
                                turkishHint: "🇹🇷 Güvenebileceğin, güvenilir kişi demek"
                            },
                            {
                                text: "How did Muhammad solve the Black Stone problem when rebuilding the Ka'bah?",
                                answers: ["He fought for it", "He used a cloth so all tribes could lift it together", "He gave up", "He chose randomly"],
                                correct: 1,
                                difficulty: "★★★",
                                damage: 40,
                                rewards: { exp: 45, wisdom: 15, leadership: 12, item: "Wisdom of Solomon" },
                                turkishHint: "🇹🇷 Bir kumaş kullanıp tüm kabilelerin birlikte kaldırmasını sağladı"
                            },
                            {
                                text: "What was Muhammad's job as a young man?",
                                answers: ["Soldier", "Teacher", "Merchant", "Farmer"],
                                correct: 2,
                                difficulty: "★☆☆",
                                damage: 40,
                                rewards: { exp: 30, wisdom: 10, item: "Merchant's Scale" },
                                turkishHint: "🇹🇷 Tüccar olarak çalıştı, alış veriş yapardı"
                            },
                            {
                                text: "What character traits made Muhammad famous in Mecca?",
                                answers: ["Wealth and power", "Honesty, kindness, and keeping promises", "Fighting skills", "Family connections"],
                                correct: 1,
                                difficulty: "★★☆",
                                damage: 40,
                                rewards: { exp: 40, wisdom: 12, compassion: 10, item: "Noble Character Gem" },
                                turkishHint: "🇹🇷 Dürüstlük, iyilik, sözünde durma gibi güzel ahlakı vardı"
                            }
                        ]
                    },
                    {
                        name: "Marriage and Wisdom",
                        boss: "Guardian of Love",
                        avatar: "💑",
                        health: 180,
                        questions: [
                            {
                                text: "Who was Khadijah?",
                                answers: ["A poor woman", "A rich merchant woman who married Muhammad", "Muhammad's sister", "A servant"],
                                correct: 1,
                                difficulty: "★☆☆",
                                damage: 50,
                                rewards: { exp: 35, wisdom: 12, compassion: 8, item: "Marriage Blessing" },
                                turkishHint: "🇹🇷 Zengin tüccar kadın, Muhammed'le evlendi"
                            },
                            {
                                text: "Why did Khadijah want to marry Muhammad?",
                                answers: ["He was handsome", "He was honest and trustworthy in business", "He was rich", "He was young"],
                                correct: 1,
                                difficulty: "★★☆",
                                damage: 50,
                                rewards: { exp: 40, wisdom: 15, leadership: 10, item: "Business Honor" },
                                turkishHint: "🇹🇷 Ticarette dürüst ve güvenilir olduğu için"
                            },
                            {
                                text: "What did the monk Bahira notice about young Muhammad?",
                                answers: ["Nothing special", "A cloud shading him and signs of prophethood", "He was very tall", "He had money"],
                                correct: 1,
                                difficulty: "★★★",
                                damage: 50,
                                rewards: { exp: 50, wisdom: 20, item: "Divine Sign Recognition" },
                                turkishHint: "🇹🇷 Üzerinde bulut gölgesi ve peygamberlik işaretleri gördü"
                            },
                            {
                                text: "How did Muhammad show kindness to the poor and orphans?",
                                answers: ["He ignored them", "He helped and supported them always", "He gave them work only", "He avoided them"],
                                correct: 1,
                                difficulty: "★★☆",
                                damage: 50,
                                rewards: { exp: 45, compassion: 20, item: "Orphan's Friend Medal" },
                                turkishHint: "🇹🇷 Hep yardım etti, sahip çıktı, destekledi"
                            },
                            {
                                text: "What does 'MERCHANT' mean?",
                                answers: ["A person who buys and sells things", "A teacher", "A soldier", "A farmer"],
                                correct: 0,
                                difficulty: "★☆☆",
                                damage: 50,
                                rewards: { exp: 30, wisdom: 10, item: "Trade Wisdom" },
                                turkishHint: "🇹🇷 Alış veriş yapan kişi - tüccar"
                            }
                        ]
                    }
                ]
            }
        };

        // Battle System
        function startChapter(chapterKey) {
            if (chapterKey !== 'week1') {
                showAchievement("🔒 Locked Chapter", "Complete previous chapters to unlock!");
                return;
            }
            
            gameState.player.currentChapter = chapterKey;
            const chapter = questData[chapterKey];
            
            // Start with first section
            startSection(chapter.sections[0]);
        }

        function startSection(section) {
            gameState.game.currentBattle = {
                section: section,
                currentQuestionIndex: 0,
                questionsAnswered: 0,
                correctAnswers: 0,
                consecutiveCorrect: 0,
                enemy: {
                    name: section.boss,
                    health: section.health,
                    maxHealth: section.health,
                    avatar: section.avatar
                }
            };
            
            showBattleArena();
            loadCurrentQuestion();
        }

        function showBattleArena() {
            const battle = gameState.game.currentBattle;
            const arena = document.getElementById('battleArena');
            
            if (!battle || !arena) {
                console.log('Battle or arena not found');
                return;
            }
            
            // Safely update battle display
            const battleTitle = document.getElementById('battleTitle');
            if (battleTitle) {
                battleTitle.textContent = `⚔️ ${battle.section.name || 'Unknown Section'} ⚔️`;
            }
            
            const battleSubtitle = document.getElementById('battleSubtitle');
            if (battleSubtitle) {
                battleSubtitle.textContent = `Face the ${battle.enemy.name || 'Unknown Enemy'}!`;
            }
            
            const battleEnemyAvatar = document.getElementById('battleEnemyAvatar');
            if (battleEnemyAvatar) {
                battleEnemyAvatar.textContent = battle.enemy.avatar || '👹';
            }
            
            const battleEnemyName = document.getElementById('battleEnemyName');
            if (battleEnemyName) {
                battleEnemyName.textContent = battle.enemy.name || 'Unknown Enemy';
            }
            
            const battleEnemyHealthText = document.getElementById('battleEnemyHealthText');
            if (battleEnemyHealthText) {
                battleEnemyHealthText.textContent = `${battle.enemy.health || 0}/${battle.enemy.maxHealth || 100}`;
            }
            
            // Clear combat log
            const combatLog = document.getElementById('combatLog');
            if (combatLog) {
                combatLog.innerHTML = '';
                addCombatLog(`⚔️ The ${battle.enemy.name || 'Unknown Enemy'} appears!`, 'system');
                addCombatLog('💡 Answer questions correctly to deal damage!', 'system');
                addCombatLog('❌ Wrong answers will cost you health!', 'system');
            }
            
            arena.classList.add('active');
            
            // Show Turkish help panel
            const turkishHelpPanel = document.getElementById('turkishHelpPanel');
            if (turkishHelpPanel) {
                turkishHelpPanel.style.display = 'block';
            }
        }

        function loadCurrentQuestion() {
            const battle = gameState.game.currentBattle;
            
            if (!battle) {
                console.log('No active battle');
                return;
            }
            
            const question = battle.section.questions[battle.currentQuestionIndex];
            
            if (!question) {
                // Section completed
                console.log('Section completed, calling completeSection');
                completeSection();
                return;
            }
            
            console.log(`Loading question ${battle.currentQuestionIndex + 1}:`, question.text);
            
            // Safely update question display
            const questionNumber = document.getElementById('questionNumber');
            if (questionNumber) {
                questionNumber.textContent = `Question ${battle.currentQuestionIndex + 1} of ${battle.section.questions.length}`;
            }
            
            const questionDifficulty = document.getElementById('questionDifficulty');
            if (questionDifficulty) {
                questionDifficulty.textContent = question.difficulty || "★☆☆";
            }
            
            const questionText = document.getElementById('questionText');
            if (questionText) {
                questionText.textContent = question.text || "Question loading...";
            }
            
            // Create answer choices
            const answerGrid = document.getElementById('answerGrid');
            if (answerGrid) {
                answerGrid.innerHTML = '';
                
                if (question.answers && Array.isArray(question.answers)) {
                    question.answers.forEach((answer, index) => {
                        const button = document.createElement('div');
                        button.className = 'answer-choice';
                        button.textContent = answer || `Option ${index + 1}`;
                        button.onclick = () => answerQuestion(index);
                        answerGrid.appendChild(button);
                    });
                }
            }
            
            // Reset help hint
            const helpHint = document.getElementById('helpHint');
            if (helpHint) {
                helpHint.style.display = 'none';
            }
            
            // Play question sound
            playTone(600, 0.3);
        }

        function answerQuestion(selectedIndex) {
            const battle = gameState.game.currentBattle;
            
            if (!battle) {
                console.log('No active battle in answerQuestion');
                return;
            }
            
            const question = battle.section.questions[battle.currentQuestionIndex];
            const isCorrect = selectedIndex === question.correct;
            
            console.log(`Answer selected: ${selectedIndex}, Correct: ${question.correct}, Is Correct: ${isCorrect}`);
            
            // Disable all choices immediately
            const choices = document.querySelectorAll('.answer-choice');
            choices.forEach((choice, index) => {
                choice.onclick = null;
                choice.style.pointerEvents = 'none';
                if (index === question.correct) {
                    choice.classList.add('correct');
                } else if (index === selectedIndex && !isCorrect) {
                    choice.classList.add('incorrect');
                }
            });
            
            if (isCorrect) {
                handleCorrectAnswer(question);
            } else {
                handleIncorrectAnswer(question);
            }
            
            // Move to next question
            battle.currentQuestionIndex++;
            battle.questionsAnswered++;
            
            console.log(`Moving to question index: ${battle.currentQuestionIndex}`);
            
            updateUI();
            
            // Check if enemy is defeated before moving to next question
            if (battle.enemy.health <= 0) {
                setTimeout(() => {
                    completeSection();
                }, 2000);
                return;
            }
            
            // Check if player is defeated
            if (gameState.player.health <= 0) {
                setTimeout(() => {
                    showDefeatModal();
                }, 1500);
                return;
            }
            
            // Load next question after delay
            setTimeout(() => {
                // Re-enable pointer events and clear styling
                const allChoices = document.querySelectorAll('.answer-choice');
                allChoices.forEach(choice => {
                    choice.classList.remove('correct', 'incorrect');
                    choice.style.pointerEvents = 'auto';
                });
                
                loadCurrentQuestion();
            }, 2500);
        }

        function handleCorrectAnswer(question) {
            const battle = gameState.game.currentBattle;
            
            // Deal damage to enemy
            battle.enemy.health -= question.damage;
            battle.enemy.health = Math.max(0, battle.enemy.health);
            
            // Update consecutive correct
            battle.correctAnswers++;
            battle.consecutiveCorrect++;
            
            // Give rewards
            giveRewards(question.rewards);
            
            // Combat log
            addCombatLog(`⚔️ Correct! You deal ${question.damage} damage!`, 'player');
            addCombatLog(`🎁 Earned: ${question.rewards.item}, +${question.rewards.exp} EXP`, 'reward');
            
            // Update enemy health display
            const healthPercentage = (battle.enemy.health / battle.enemy.maxHealth) * 100;
            document.getElementById('battleEnemyHealth').style.width = healthPercentage + '%';
            document.getElementById('battleEnemyHealthText').textContent = 
                `${battle.enemy.health}/${battle.enemy.maxHealth}`;
            
            // Play correct sound
            playCorrectAnswerSound();
            
            // Check for special attack unlock
            if (battle.consecutiveCorrect >= 3) {
                gameState.player.specialAttackReady = true;
                document.getElementById('specialAttackBtn').disabled = false;
                addCombatLog('⚡ Special Attack ready!', 'system');
            }
            
            // Check for achievements
            checkAchievements();
        }

        function handleIncorrectAnswer(question) {
            const battle = gameState.game.currentBattle;
            
            // Player takes damage
            const damage = 20;
            gameState.player.health -= damage;
            gameState.player.health = Math.max(0, gameState.player.health);
            
            // Reset consecutive correct
            battle.consecutiveCorrect = 0;
            gameState.player.specialAttackReady = false;
            document.getElementById('specialAttackBtn').disabled = true;
            
            // Combat log
            addCombatLog(`💥 Wrong answer! You take ${damage} damage!`, 'enemy');
            addCombatLog(`💡 Correct answer was: ${question.answers[question.correct]}`, 'system');
            
            // Play incorrect sound
            playIncorrectAnswerSound();
            
            // Check if player is defeated
            if (gameState.player.health <= 0) {
                setTimeout(() => showDefeatModal(), 1500);
                return;
            }
        }

        function giveRewards(rewards) {
            // Add experience
            gameState.player.exp += rewards.exp;
            
            // Add stats
            if (rewards.wisdom) {
                gameState.player.wisdom += rewards.wisdom;
                gameState.player.wisdom = Math.min(100, gameState.player.wisdom);
            }
            if (rewards.courage) {
                gameState.player.courage += rewards.courage;
                gameState.player.courage = Math.min(100, gameState.player.courage);
            }
            if (rewards.compassion) {
                gameState.player.compassion += rewards.compassion;
                gameState.player.compassion = Math.min(100, gameState.player.compassion);
            }
            if (rewards.leadership) {
                gameState.player.leadership += rewards.leadership;
                gameState.player.leadership = Math.min(100, gameState.player.leadership);
            }
            
            // Add item to inventory
            if (rewards.item && gameState.player.inventory.length < 12) {
                gameState.player.inventory.push(rewards.item);
            }
            
            // Check for level up
            checkLevelUp();
        }

        function checkLevelUp() {
            while (gameState.player.exp >= gameState.player.expToNext) {
                gameState.player.exp -= gameState.player.expToNext;
                gameState.player.level++;
                gameState.player.maxHealth += 25;
                gameState.player.health = gameState.player.maxHealth; // Full heal
                gameState.player.expToNext = Math.floor(gameState.player.expToNext * 1.4);
                
                addCombatLog(`🎉 LEVEL UP! Now level ${gameState.player.level}!`, 'reward');
                playVictorySound();
                
                // Award achievement
                showAchievement("📈 Level Up!", `Welcome to Level ${gameState.player.level}!`);
            }
        }

        function completeSection() {
            const battle = gameState.game.currentBattle;
            addCombatLog(`🏆 ${battle.enemy.name} defeated!`, 'system');
            
            // Give completion bonus
            const bonusExp = 100;
            gameState.player.exp += bonusExp;
            addCombatLog(`🎁 Section completion bonus: +${bonusExp} EXP!`, 'reward');
            
            playVictorySound();
            checkLevelUp();
            
            setTimeout(() => showVictoryModal(), 1500);
        }

        function useTurkishHelp() {
            if (gameState.game.turkishHelpCount <= 0) {
                addCombatLog('❌ No Turkish help remaining!', 'system');
                return;
            }
            
            if (!gameState.game.currentBattle) return;
            
            const battle = gameState.game.currentBattle;
            const question = battle.section.questions[battle.currentQuestionIndex];
            
            gameState.game.turkishHelpCount--;
            
            // Show hint
            const hintElement = document.getElementById('helpHint');
            hintElement.textContent = question.turkishHint;
            hintElement.style.display = 'block';
            
            addCombatLog('🆘 Turkish hint revealed!', 'system');
            updateUI();
        }

        function useSpecialAttack() {
            if (!gameState.player.specialAttackReady) return;
            
            const battle = gameState.game.currentBattle;
            const damage = 75;
            
            battle.enemy.health -= damage;
            battle.enemy.health = Math.max(0, battle.enemy.health);
            
            gameState.player.specialAttackReady = false;
            document.getElementById('specialAttackBtn').disabled = true;
            
            addCombatLog(`⚡ SPECIAL ATTACK! Massive ${damage} damage!`, 'player');
            playTone(1000, 0.5, 'square');
            
            // Update enemy health
            const healthPercentage = (battle.enemy.health / battle.enemy.maxHealth) * 100;
            document.getElementById('battleEnemyHealth').style.width = healthPercentage + '%';
            document.getElementById('battleEnemyHealthText').textContent = 
                `${battle.enemy.health}/${battle.enemy.maxHealth}`;
            
            if (battle.enemy.health <= 0) {
                setTimeout(() => completeSection(), 1000);
            }
        }

        function retreatFromBattle() {
            addCombatLog('🏃 Strategic retreat! You live to fight another day.', 'system');
            closeBattleArena();
        }

        function closeBattleArena() {
            document.getElementById('battleArena').classList.remove('active');
            document.getElementById('turkishHelpPanel').style.display = 'none';
            gameState.game.currentBattle = null;
        }

        function showVictoryModal() {
            const modal = document.getElementById('victoryModal');
            const battle = gameState.game.currentBattle;
            
            document.getElementById('victoryMessage').textContent = 
                `You have conquered the ${battle.section.name}! Your wisdom and courage shine bright!`;
            
            // Show rewards
            const rewardsDiv = document.getElementById('victoryRewards');
            rewardsDiv.innerHTML = `
                <h3 style="color: #f39c12; margin-bottom: 15px;">🎁 Victory Rewards</h3>
                <div class="reward-item"><span>📚 Section Completed</span><span>${battle.section.name}</span></div>
                <div class="reward-item"><span>⭐ Total EXP Gained</span><span>+${battle.correctAnswers * 35} EXP</span></div>
                <div class="reward-item"><span>📦 Items Collected</span><span>${battle.correctAnswers} Sacred Items</span></div>
                <div class="reward-item"><span>🎯 Accuracy</span><span>${Math.round(battle.correctAnswers / battle.questionsAnswered * 100)}%</span></div>
            `;
            
            modal.style.display = 'block';
            
            // Check for achievements
            if (battle.correctAnswers === battle.questionsAnswered) {
                showAchievement("🎯 Perfect Score!", "Answered all questions correctly!");
            }
        }

        function showDefeatModal() {
            const modal = document.getElementById('defeatModal');
            document.getElementById('defeatMessage').textContent = 
                'The path of knowledge is challenging, but each setback makes you stronger. Rise again, noble seeker!';
            
            modal.style.display = 'block';
            playDefeatSound();
        }

        function closeModal(type) {
            document.getElementById(type + 'Modal').style.display = 'none';
            
            if (type === 'victory') {
                // Move to next section or chapter
                const currentChapter = questData[gameState.player.currentChapter];
                const currentSectionIndex = currentChapter.sections.findIndex(s => 
                    s.name === gameState.game.currentBattle.section.name);
                
                if (currentSectionIndex < currentChapter.sections.length - 1) {
                    // Next section
                    startSection(currentChapter.sections[currentSectionIndex + 1]);
                } else {
                    // Chapter completed
                    completeChapter();
                }
            } else {
                // Defeat - restore health and retry
                gameState.player.health = gameState.player.maxHealth;
                updateUI();
                closeBattleArena();
            }
        }

        function returnToMap() {
            closeModal('defeat');
            closeBattleArena();
            gameState.player.health = gameState.player.maxHealth;
            updateUI();
        }

        function completeChapter() {
            gameState.player.chaptersCompleted.push(gameState.player.currentChapter);
            closeBattleArena();
            
            showAchievement("🏆 Chapter Complete!", "The Orphan's Rise - A journey of character and wisdom!");
            
            // Unlock next chapter
            unlockNextChapter();
        }

        function unlockNextChapter() {
            const chapterOrder = ['week1', 'week2', 'week3', 'week4'];
            const currentIndex = chapterOrder.indexOf(gameState.player.currentChapter);
            
            if (currentIndex < chapterOrder.length - 1) {
                const nextChapter = chapterOrder[currentIndex + 1];
                document.getElementById(`chapter-${nextChapter}`).classList.remove('locked');
                document.getElementById(`chapter-${nextChapter}`).classList.add('current');
                
                addCombatLog(`🗝️ ${nextChapter.toUpperCase()} unlocked!`, 'system');
            }
        }

        function checkAchievements() {
            const battle = gameState.game.currentBattle;
            
            // First victory
            if (battle.correctAnswers === 1 && !gameState.player.achievements.includes('first_victory')) {
                gameState.player.achievements.push('first_victory');
                showAchievement("🏆 First Victory!", "You've won your first battle!");
            }
            
            // Perfect streak
            if (battle.consecutiveCorrect >= 5 && !gameState.player.achievements.includes('perfectionist')) {
                gameState.player.achievements.push('perfectionist');
                showAchievement("🎯 Perfectionist!", "5 correct answers in a row!");
            }
            
            // Scholar achievement
            const totalCorrect = gameState.player.achievements.filter(a => a.includes('correct')).length;
            if (totalCorrect >= 25 && !gameState.player.achievements.includes('scholar')) {
                gameState.player.achievements.push('scholar');
                showAchievement("📚 Scholar!", "Answered 25 questions correctly!");
            }
        }

        function showAchievement(title, description) {
            const popup = document.getElementById('achievementPopup');
            document.getElementById('achievementTitle').textContent = title;
            document.getElementById('achievementDescription').textContent = description;
            
            popup.classList.add('show');
            playVictorySound();
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 4000);
        }

        function addCombatLog(message, type) {
            const log = document.getElementById('combatLog');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = message;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        function updateUI() {
            try {
                const player = gameState.player;
                
                // Helper function for safe text updates
                function safeSetText(id, text) {
                    try {
                        const element = document.getElementById(id);
                        if (element && text !== null && text !== undefined) {
                            element.textContent = String(text);
                        }
                    } catch (e) {
                        console.warn(`Failed to update ${id}:`, e);
                    }
                }
                
                // Helper function for safe style updates
                function safeSetStyle(id, property, value) {
                    try {
                        const element = document.getElementById(id);
                        if (element && value !== null && value !== undefined) {
                            element.style[property] = String(value);
                        }
                    } catch (e) {
                        console.warn(`Failed to update style ${id}.${property}:`, e);
                    }
                }
                
                // Update character stats safely
                safeSetText('playerLevel', player.level);
                safeSetText('healthText', `${player.health}/${player.maxHealth}`);
                safeSetText('expText', `${player.exp}/${player.expToNext}`);
                safeSetText('wisdomText', `${player.wisdom}/100`);
                safeSetText('courageText', `${player.courage}/100`);
                safeSetText('compassionText', `${player.compassion}/100`);
                safeSetText('leadershipText', `${player.leadership}/100`);
                safeSetText('achievementCount', player.achievements.length);
                
                // Update bars safely
                safeSetStyle('healthBar', 'width', (player.health / player.maxHealth * 100) + '%');
                safeSetStyle('expBar', 'width', (player.exp / player.expToNext * 100) + '%');
                safeSetStyle('wisdomBar', 'width', (player.wisdom / 100 * 100) + '%');
                safeSetStyle('courageBar', 'width', (player.courage / 100 * 100) + '%');
                safeSetStyle('compassionBar', 'width', (player.compassion / 100 * 100) + '%');
                safeSetStyle('leadershipBar', 'width', (player.leadership / 100 * 100) + '%');
                
                // Update battle health if in battle
                if (gameState.game.currentBattle) {
                    safeSetStyle('battlePlayerHealth', 'width', (player.health / player.maxHealth * 100) + '%');
                    safeSetText('battlePlayerHealthText', `${player.health}/${player.maxHealth}`);
                }
                
                // Update help counter
                safeSetText('helpCount', gameState.game.turkishHelpCount);
                safeSetText('helpButton', `🆘 Turkish Help (${gameState.game.turkishHelpCount} left)`);
                
                // Update inventory
                updateInventoryDisplay();
                
            } catch (error) {
                console.error('❌ Error updating UI:', error);
            }
        }

        function updateInventoryDisplay() {
            try {
                const slots = document.querySelectorAll('.inventory-slot');
                
                if (!slots || slots.length === 0) {
                    console.warn('No inventory slots found');
                    return;
                }
                
                slots.forEach((slot, index) => {
                    try {
                        if (gameState.player.inventory[index]) {
                            const item = gameState.player.inventory[index];
                            const icon = getItemIcon(item);
                            
                            if (slot) {
                                slot.textContent = icon;
                                slot.classList.add('filled');
                                
                                const tooltip = slot.querySelector('.item-tooltip');
                                if (tooltip) {
                                    tooltip.textContent = item;
                                }
                            }
                        } else {
                            if (slot) {
                                slot.textContent = '📭';
                                slot.classList.remove('filled');
                                
                                const tooltip = slot.querySelector('.item-tooltip');
                                if (tooltip) {
                                    tooltip.textContent = 'Empty Slot';
                                }
                            }
                        }
                    } catch (slotError) {
                        console.warn(`Error updating inventory slot ${index}:`, slotError);
                    }
                });
                
            } catch (error) {
                console.error('❌ Error updating inventory:', error);
            }
        }

        function getItemIcon(itemName) {
            const icons = {
                "Orphan's Wisdom Gem": "💎",
                "Desert Blessing": "🌟",
                "Blessing of Abundance": "🌾",
                "Courage in Hardship": "💪",
                "Guardian's Protection": "🛡️",
                "Trustworthy Badge": "🏅",
                "Truth Crystal": "💎",
                "Wisdom of Solomon": "👑",
                "Merchant's Scale": "⚖️",
                "Noble Character Gem": "✨",
                "Marriage Blessing": "💍",
                "Business Honor": "📜",
                "Divine Sign Recognition": "👁️",
                "Orphan's Friend Medal": "🏅",
                "Trade Wisdom": "📊"
            };
            return icons[itemName] || "📦";
        }

        function showCharacterDetails() {
            // Add character detail modal functionality
            console.log('Character details clicked');
        }

        // Initialize game
        function initGame() {
            try {
                console.log('🎮 Initializing Epic Prophet Muhammad RPG Quest...');
                
                // Initialize audio
                initAudio();
                
                // Create particles
                createParticles();
                
                // Update UI safely
                setTimeout(() => {
                    updateUI();
                }, 100);
                
                console.log('✅ Game initialized successfully!');
                console.log('🎵 Music system ready!');
                console.log('⚔️ Battle system loaded!');
                console.log('🏆 Achievement system active!');
                
                // Show welcome achievement
                setTimeout(() => {
                    showAchievement("🎮 Welcome!", "Your epic journey begins!");
                }, 1000);
                
            } catch (error) {
                console.error('❌ Error initializing game:', error);
            }
        }

        // Start game when page loads - with error handling
        window.addEventListener('load', function() {
            try {
                console.log('📄 Page loaded, starting game initialization...');
                
                // Wait a bit for DOM to be fully ready
                setTimeout(() => {
                    initGame();
                }, 200);
                
            } catch (error) {
                console.error('❌ Error on page load:', error);
                
                // Try to show a simple error message
                document.body.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: white; background: #2c3e50;">
                        <h1>🎮 Prophet Muhammad Epic Quest</h1>
                        <p>⚠️ Loading error occurred. Please refresh the page.</p>
                        <button onclick="location.reload()" style="padding: 10px 20px; font-size: 16px;">
                            🔄 Refresh Page
                        </button>
                    </div>
                `;
            }
        });
    </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎵 Prophet Muhammad Epic RPG Quest</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            min-height: 100vh;
            color: #ffffff;
            overflow-x: hidden;
            position: relative;
        }

        /* Animated Background */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .particle {
            position: absolute;
            background: radial-gradient(circle, #ffd700 0%, transparent 70%);
            border-radius: 50%;
            animation: float 6s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 10;
        }

        /* Music Control Panel */
        .music-control {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(44, 62, 80, 0.9);
            border-radius: 15px;
            padding: 15px;
            z-index: 1000;
            border: 2px solid #f39c12;
            backdrop-filter: blur(10px);
        }

        .music-toggle {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .music-toggle:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .music-toggle.playing {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
        }

        .volume-control {
            margin-top: 10px;
            width: 100%;
        }

        .volume-slider {
            width: 100%;
            height: 5px;
            border-radius: 5px;
            background: #34495e;
            outline: none;
            cursor: pointer;
        }

        /* Game Header */
        .epic-header {
            text-align: center;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            border: 4px solid #f39c12;
            box-shadow: 0 0 50px rgba(243, 156, 18, 0.4);
            position: relative;
            overflow: hidden;
        }

        .epic-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            animation: sweep 3s infinite;
        }

        @keyframes sweep {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .epic-title {
            font-size: 3.5em;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #f39c12, #e67e22, #d35400);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            position: relative;
            z-index: 2;
        }

        .epic-subtitle {
            font-size: 1.4em;
            color: #ecf0f1;
            margin-bottom: 20px;
            position: relative;
            z-index: 2;
        }

        /* Enhanced Character Panel */
        .character-display {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            background: rgba(52, 73, 94, 0.95);
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
            border: 3px solid #3498db;
            backdrop-filter: blur(10px);
        }

        .character-avatar-section {
            text-align: center;
        }

        .character-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(45deg, #3498db, #2980b9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            border: 4px solid #f39c12;
            margin: 0 auto 15px;
            animation: avatarGlow 3s infinite;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .character-avatar:hover {
            transform: scale(1.1);
        }

        @keyframes avatarGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(52, 152, 219, 0.5); }
            50% { box-shadow: 0 0 40px rgba(52, 152, 219, 0.8); }
        }

        .character-name {
            font-size: 1.3em;
            color: #f39c12;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .character-class {
            color: #ecf0f1;
            font-size: 1.1em;
        }

        .character-stats {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .stat-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(44, 62, 80, 0.6);
            padding: 12px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-label {
            font-weight: bold;
            color: #ecf0f1;
            font-size: 1em;
        }

        .stat-bar-container {
            flex: 1;
            margin: 0 15px;
            height: 20px;
            background: rgba(149, 165, 166, 0.3);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .stat-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 1.5s ease;
            position: relative;
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .health-bar { background: linear-gradient(45deg, #e74c3c, #c0392b); }
        .exp-bar { background: linear-gradient(45deg, #f39c12, #e67e22); }
        .wisdom-bar { background: linear-gradient(45deg, #9b59b6, #8e44ad); }
        .courage-bar { background: linear-gradient(45deg, #e67e22, #d35400); }
        .compassion-bar { background: linear-gradient(45deg, #1abc9c, #16a085); }
        .leadership-bar { background: linear-gradient(45deg, #3498db, #2980b9); }

        .stat-value {
            font-weight: bold;
            color: #f39c12;
            min-width: 80px;
            text-align: right;
        }

        /* Enhanced Inventory */
        .inventory-panel {
            background: rgba(44, 62, 80, 0.9);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #27ae60;
        }

        .inventory-title {
            text-align: center;
            color: #f39c12;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }

        .inventory-slot {
            width: 70px;
            height: 70px;
            border: 2px solid #7f8c8d;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(52, 73, 94, 0.5);
            font-size: 1.5em;
            position: relative;
        }

        .inventory-slot:hover {
            border-color: #f39c12;
            background: rgba(243, 156, 18, 0.2);
            transform: scale(1.05);
        }

        .inventory-slot.filled {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            border-color: #27ae60;
            animation: itemGlow 2s infinite;
        }

        @keyframes itemGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(39, 174, 96, 0.5); }
            50% { box-shadow: 0 0 20px rgba(39, 174, 96, 0.8); }
        }

        .item-tooltip {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(44, 62, 80, 0.95);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.8em;
            white-space: nowrap;
            display: none;
            z-index: 100;
            border: 1px solid #f39c12;
        }

        .inventory-slot:hover .item-tooltip {
            display: block;
        }

        /* Chapter Selection Map */
        .chapter-map {
            background: rgba(44, 62, 80, 0.95);
            border-radius: 25px;
            padding: 40px;
            margin: 40px 0;
            border: 4px solid #3498db;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .map-title {
            text-align: center;
            font-size: 2.2em;
            color: #f39c12;
            margin-bottom: 30px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .chapter-card {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .chapter-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .chapter-card:hover::before {
            left: 100%;
        }

        .chapter-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: #f39c12;
            box-shadow: 0 15px 40px rgba(243, 156, 18, 0.4);
        }

        .chapter-card.completed {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border-color: #27ae60;
        }

        .chapter-card.current {
            background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%);
            border-color: #f39c12;
            animation: currentChapter 3s infinite;
        }

        .chapter-card.locked {
            background: linear-gradient(135deg, #7f8c8d 0%, #95a5a6 100%);
            border-color: #95a5a6;
            opacity: 0.6;
            cursor: not-allowed;
        }

        @keyframes currentChapter {
            0%, 100% { box-shadow: 0 0 30px rgba(243, 156, 18, 0.6); }
            50% { box-shadow: 0 0 50px rgba(243, 156, 18, 0.9); }
        }

        .chapter-icon {
            font-size: 4em;
            margin-bottom: 15px;
            display: block;
        }

        .chapter-title {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #ecf0f1;
        }

        .chapter-description {
            font-size: 0.95em;
            color: #bdc3c7;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .chapter-progress {
            font-size: 0.9em;
            color: #f39c12;
            font-weight: bold;
        }

        .chapter-rewards {
            font-size: 0.85em;
            color: #2ecc71;
            margin-top: 10px;
        }

        /* Enhanced Battle System */
        .battle-arena {
            display: none;
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            border-radius: 25px;
            padding: 40px;
            margin: 40px 0;
            border: 4px solid #e74c3c;
            position: relative;
            backdrop-filter: blur(10px);
        }

        .battle-arena.active {
            display: block;
            animation: battleEnter 1.5s ease;
        }

        @keyframes battleEnter {
            0% { transform: scale(0.8) rotateY(180deg); opacity: 0; }
            50% { transform: scale(1.1) rotateY(90deg); }
            100% { transform: scale(1) rotateY(0deg); opacity: 1; }
        }

        .battle-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .battle-title {
            font-size: 2.5em;
            color: #f39c12;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .battle-subtitle {
            font-size: 1.2em;
            color: #ecf0f1;
        }

        .battle-participants {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
        }

        .participant {
            text-align: center;
            flex: 1;
        }

        .participant-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            margin: 0 auto 20px;
            border: 4px solid;
            animation: participantPulse 2s infinite;
        }

        .player-avatar {
            background: linear-gradient(45deg, #3498db, #2980b9);
            border-color: #3498db;
        }

        .enemy-avatar {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            border-color: #e74c3c;
        }

        @keyframes participantPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .participant-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #f39c12;
        }

        .participant-health {
            width: 200px;
            height: 25px;
            background: rgba(52, 73, 94, 0.8);
            border-radius: 12px;
            margin: 0 auto;
            overflow: hidden;
            border: 2px solid;
            position: relative;
        }

        .health-fill {
            height: 100%;
            transition: width 1.5s ease;
            border-radius: 10px;
        }

        .player-health { border-color: #3498db; }
        .player-health .health-fill { background: linear-gradient(45deg, #3498db, #2980b9); }

        .enemy-health { border-color: #e74c3c; }
        .enemy-health .health-fill { background: linear-gradient(45deg, #e74c3c, #c0392b); }

        .health-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        .vs-indicator {
            font-size: 3em;
            color: #f39c12;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            animation: vsGlow 2s infinite;
        }

        @keyframes vsGlow {
            0%, 100% { text-shadow: 2px 2px 4px rgba(0,0,0,0.5); }
            50% { text-shadow: 0 0 20px rgba(243, 156, 18, 0.8); }
        }

        /* Enhanced Question System */
        .question-panel {
            background: rgba(44, 62, 80, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 3px solid #3498db;
            backdrop-filter: blur(10px);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1em;
        }

        .question-difficulty {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .question-text {
            font-size: 1.4em;
            margin-bottom: 25px;
            text-align: center;
            color: #ecf0f1;
            line-height: 1.5;
            padding: 20px;
            background: rgba(52, 73, 94, 0.5);
            border-radius: 15px;
            border-left: 5px solid #f39c12;
        }

        .answer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .answer-choice {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            border: 3px solid #3498db;
            color: white;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
            position: relative;
            overflow: hidden;
        }

        .answer-choice::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .answer-choice:hover::before {
            left: 100%;
        }

        .answer-choice:hover {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.4);
        }

        .answer-choice.correct {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border-color: #27ae60;
            animation: correctAnswer 1s ease;
        }

        .answer-choice.incorrect {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            border-color: #e74c3c;
            animation: incorrectAnswer 0.5s ease;
        }

        @keyframes correctAnswer {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes incorrectAnswer {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* Enhanced Combat Log */
        .combat-log-panel {
            background: rgba(44, 62, 80, 0.95);
            border-radius: 15px;
            padding: 20px;
            height: 200px;
            overflow-y: auto;
            margin: 25px 0;
            border: 2px solid #7f8c8d;
            font-family: 'Courier New', monospace;
            backdrop-filter: blur(10px);
        }

        .log-entry {
            margin: 8px 0;
            padding: 8px 12px;
            border-radius: 8px;
            animation: logEntryAppear 0.5s ease;
        }

        @keyframes logEntryAppear {
            0% { opacity: 0; transform: translateX(-20px); }
            100% { opacity: 1; transform: translateX(0); }
        }

        .log-player { 
            background: rgba(52, 152, 219, 0.2); 
            color: #3498db; 
            border-left: 4px solid #3498db;
        }
        .log-enemy { 
            background: rgba(231, 76, 60, 0.2); 
            color: #e74c3c; 
            border-left: 4px solid #e74c3c;
        }
        .log-system { 
            background: rgba(149, 165, 166, 0.2); 
            color: #95a5a6; 
            border-left: 4px solid #95a5a6;
        }
        .log-reward { 
            background: rgba(46, 204, 113, 0.2); 
            color: #2ecc71; 
            border-left: 4px solid #2ecc71;
        }

        /* Action Buttons */
        .action-panel {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .action-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
            border-color: #f39c12;
        }

        .action-btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .help-btn {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .help-btn:hover {
            box-shadow: 0 8px 20px rgba(243, 156, 18, 0.4);
        }

        .retreat-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .retreat-btn:hover {
            box-shadow: 0 8px 20px rgba(231, 76, 60, 0.4);
        }

        /* Victory/Defeat Modals */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            border: 4px solid #f39c12;
            box-shadow: 0 0 50px rgba(243, 156, 18, 0.5);
            max-width: 600px;
            width: 90%;
            animation: modalAppear 1s ease;
        }

        @keyframes modalAppear {
            0% { transform: translate(-50%, -50%) scale(0.5) rotateY(180deg); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1) rotateY(0deg); opacity: 1; }
        }

        .victory-content {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border-color: #27ae60;
        }

        .defeat-content {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            border-color: #e74c3c;
        }

        .modal-title {
            font-size: 3em;
            margin-bottom: 20px;
            animation: titlePulse 2s infinite;
        }

        @keyframes titlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .modal-message {
            font-size: 1.3em;
            margin: 20px 0;
            line-height: 1.5;
        }

        .reward-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .reward-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        /* Turkish Help Panel */
        .turkish-help-panel {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: rgba(241, 196, 15, 0.95);
            color: #8b4513;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #f39c12;
            z-index: 1500;
            backdrop-filter: blur(10px);
            max-width: 250px;
        }

        